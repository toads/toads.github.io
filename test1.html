<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨æƒé™å®‰å…¨æµ‹è¯•å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .test-card.success {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .test-card.error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .test-card.warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        
        .test-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-pending {
            background: #6c757d;
            color: white;
        }
        
        .status-success {
            background: #28a745;
            color: white;
        }
        
        .status-error {
            background: #dc3545;
            color: white;
        }
        
        .status-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .summary {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .summary h3 {
            margin-bottom: 15px;
            color: #1976d2;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #bbdefb;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .auto-test-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .countdown {
            font-size: 1.2em;
            font-weight: bold;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ æµè§ˆå™¨æƒé™å®‰å…¨æµ‹è¯•å™¨</h1>
        
        <div class="auto-test-info">
            <div class="countdown" id="countdown">è‡ªåŠ¨æµ‹è¯•å°†åœ¨ <span id="timer">5</span> ç§’åå¼€å§‹...</div>
            <p>æ­¤æµ‹è¯•å°†è‡ªåŠ¨å°è¯•è·å–å„ç§æµè§ˆå™¨æƒé™ï¼Œæ— éœ€æ‰‹åŠ¨ç‚¹å‡»</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="test-grid">
            <!-- åœ°ç†ä½ç½®æµ‹è¯• -->
            <div class="test-card" id="geolocation-card">
                <div class="test-title">
                    ğŸ“ åœ°ç†ä½ç½®æƒé™
                    <span class="test-status status-pending" id="geolocation-status">ç­‰å¾…ä¸­</span>
                </div>
                <div class="test-result" id="geolocation-result">å‡†å¤‡æµ‹è¯•åœ°ç†ä½ç½®æƒé™...</div>
            </div>
            
            <!-- éº¦å…‹é£æµ‹è¯• -->
            <div class="test-card" id="microphone-card">
                <div class="test-title">
                    ğŸ¤ éº¦å…‹é£æƒé™
                    <span class="test-status status-pending" id="microphone-status">ç­‰å¾…ä¸­</span>
                </div>
                <div class="test-result" id="microphone-result">å‡†å¤‡æµ‹è¯•éº¦å…‹é£æƒé™...</div>
            </div>
            
            <!-- æ‘„åƒå¤´æµ‹è¯• -->
            <div class="test-card" id="camera-card">
                <div class="test-title">
                    ğŸ“¹ æ‘„åƒå¤´æƒé™
                    <span class="test-status status-pending" id="camera-status">ç­‰å¾…ä¸­</span>
                </div>
                <div class="test-result" id="camera-result">å‡†å¤‡æµ‹è¯•æ‘„åƒå¤´æƒé™...</div>
            </div>
            
            <!-- é€šçŸ¥æƒé™æµ‹è¯• -->
            <div class="test-card" id="notification-card">
                <div class="test-title">
                    ğŸ”” é€šçŸ¥æƒé™
                    <span class="test-status status-pending" id="notification-status">ç­‰å¾…ä¸­</span>
                </div>
                <div class="test-result" id="notification-result">å‡†å¤‡æµ‹è¯•é€šçŸ¥æƒé™...</div>
            </div>
            
            <!-- å‰ªè´´æ¿æµ‹è¯• -->
            <div class="test-card" id="clipboard-card">
                <div class="test-title">
                    ğŸ“‹ å‰ªè´´æ¿æƒé™
                    <span class="test-status status-pending" id="clipboard-status">ç­‰å¾…ä¸­</span>
                </div>
                <div class="test-result" id="clipboard-result">å‡†å¤‡æµ‹è¯•å‰ªè´´æ¿æƒé™...</div>
            </div>
            
            <!-- å­˜å‚¨æƒé™æµ‹è¯• -->
            <div class="test-card" id="storage-card">
                <div class="test-title">
                    ğŸ’¾ å­˜å‚¨æƒé™
                    <span class="test-status status-pending" id="storage-status">ç­‰å¾…ä¸­</span>
                </div>
                <div class="test-result" id="storage-result">å‡†å¤‡æµ‹è¯•å­˜å‚¨æƒé™...</div>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="startAllTests()" id="startBtn">ğŸš€ å¼€å§‹æµ‹è¯•</button>
            <button onclick="stopAllTests()" id="stopBtn" disabled>â¹ï¸ åœæ­¢æµ‹è¯•</button>
            <button onclick="resetAllTests()" id="resetBtn">ğŸ”„ é‡ç½®æµ‹è¯•</button>
        </div>
        
        <div class="summary" id="summary">
            <h3>ğŸ“Š æµ‹è¯•æ€»ç»“</h3>
            <div class="summary-item">
                <span>æ€»æµ‹è¯•æ•°:</span>
                <span id="total-tests">6</span>
            </div>
            <div class="summary-item">
                <span>æˆåŠŸ:</span>
                <span id="success-count" style="color: #28a745; font-weight: bold;">0</span>
            </div>
            <div class="summary-item">
                <span>å¤±è´¥:</span>
                <span id="error-count" style="color: #dc3545; font-weight: bold;">0</span>
            </div>
            <div class="summary-item">
                <span>è­¦å‘Š:</span>
                <span id="warning-count" style="color: #ffc107; font-weight: bold;">0</span>
            </div>
            <div class="summary-item">
                <span>å®Œæˆç‡:</span>
                <span id="completion-rate" style="color: #2196f3; font-weight: bold;">0%</span>
            </div>
        </div>
    </div>

    <script>
        let testResults = {
            geolocation: { status: 'pending', result: '' },
            microphone: { status: 'pending', result: '' },
            camera: { status: 'pending', result: '' },
            notification: { status: 'pending', result: '' },
            clipboard: { status: 'pending', result: '' },
            storage: { status: 'pending', result: '' }
        };
        
        let completedTests = 0;
        let totalTests = 6;
        let isTestRunning = false;
        let countdownInterval;
        
        // é¡µé¢åŠ è½½åå¼€å§‹å€’è®¡æ—¶
        window.addEventListener('load', function() {
            startCountdown();
        });
        
        function startCountdown() {
            let timeLeft = 5;
            const timerElement = document.getElementById('timer');
            const countdownElement = document.getElementById('countdown');
            
            countdownInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    countdownElement.innerHTML = 'ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•...';
                    setTimeout(() => {
                        startAllTests();
                    }, 1000);
                }
            }, 1000);
        }
        
        function updateProgress() {
            const progress = (completedTests / totalTests) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('completion-rate').textContent = Math.round(progress) + '%';
        }
        
        function updateSummary() {
            const successCount = Object.values(testResults).filter(r => r.status === 'success').length;
            const errorCount = Object.values(testResults).filter(r => r.status === 'error').length;
            const warningCount = Object.values(testResults).filter(r => r.status === 'warning').length;
            
            document.getElementById('success-count').textContent = successCount;
            document.getElementById('error-count').textContent = errorCount;
            document.getElementById('warning-count').textContent = warningCount;
        }
        
        function updateTestCard(testName, status, result) {
            const card = document.getElementById(testName + '-card');
            const statusElement = document.getElementById(testName + '-status');
            const resultElement = document.getElementById(testName + '-result');
            
            card.className = 'test-card ' + status;
            statusElement.className = 'test-status status-' + status;
            resultElement.textContent = result;
            
            const statusTexts = {
                'pending': 'ç­‰å¾…ä¸­',
                'success': 'æˆåŠŸ',
                'error': 'å¤±è´¥',
                'warning': 'è­¦å‘Š'
            };
            
            statusElement.textContent = statusTexts[status];
        }
        
        async function testGeolocation() {
            updateTestCard('geolocation', 'pending', 'æ­£åœ¨æµ‹è¯•åœ°ç†ä½ç½®æƒé™...');
            
            try {
                if (!navigator.geolocation) {
                    throw new Error('æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†ä½ç½®API');
                }
                
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    });
                });
                
                const result = `âœ… åœ°ç†ä½ç½®è·å–æˆåŠŸï¼
çº¬åº¦: ${position.coords.latitude}
ç»åº¦: ${position.coords.longitude}
ç²¾åº¦: ${position.coords.accuracy}ç±³
æ—¶é—´æˆ³: ${new Date(position.timestamp).toLocaleString()}`;
                
                testResults.geolocation = { status: 'success', result };
                updateTestCard('geolocation', 'success', result);
                
            } catch (error) {
                const result = `âŒ åœ°ç†ä½ç½®è·å–å¤±è´¥: ${error.message}`;
                testResults.geolocation = { status: 'error', result };
                updateTestCard('geolocation', 'error', result);
            }
            
            completedTests++;
            updateProgress();
            updateSummary();
        }
        
        async function testMicrophone() {
            updateTestCard('microphone', 'pending', 'æ­£åœ¨æµ‹è¯•éº¦å…‹é£æƒé™...');
            
            try {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('æµè§ˆå™¨ä¸æ”¯æŒåª’ä½“è®¾å¤‡API');
                }
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true,
                    video: false 
                });
                
                const audioTracks = stream.getAudioTracks();
                const result = `âœ… éº¦å…‹é£æƒé™è·å–æˆåŠŸï¼
éŸ³é¢‘è½¨é“æ•°: ${audioTracks.length}
è®¾å¤‡ID: ${audioTracks[0]?.getSettings().deviceId || 'æœªçŸ¥'}
æ ‡ç­¾: ${audioTracks[0]?.label || 'æœªçŸ¥'}`;
                
                // åœæ­¢æµ
                stream.getTracks().forEach(track => track.stop());
                
                testResults.microphone = { status: 'success', result };
                updateTestCard('microphone', 'success', result);
                
            } catch (error) {
                const result = `âŒ éº¦å…‹é£æƒé™è·å–å¤±è´¥: ${error.message}`;
                testResults.microphone = { status: 'error', result };
                updateTestCard('microphone', 'error', result);
            }
            
            completedTests++;
            updateProgress();
            updateSummary();
        }
        
        async function testCamera() {
            updateTestCard('camera', 'pending', 'æ­£åœ¨æµ‹è¯•æ‘„åƒå¤´æƒé™...');
            
            try {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('æµè§ˆå™¨ä¸æ”¯æŒåª’ä½“è®¾å¤‡API');
                }
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: false,
                    video: true 
                });
                
                const videoTracks = stream.getVideoTracks();
                const result = `âœ… æ‘„åƒå¤´æƒé™è·å–æˆåŠŸï¼
è§†é¢‘è½¨é“æ•°: ${videoTracks.length}
è®¾å¤‡ID: ${videoTracks[0]?.getSettings().deviceId || 'æœªçŸ¥'}
æ ‡ç­¾: ${videoTracks[0]?.label || 'æœªçŸ¥'}
åˆ†è¾¨ç‡: ${videoTracks[0]?.getSettings().width}x${videoTracks[0]?.getSettings().height}`;
                
                // åœæ­¢æµ
                stream.getTracks().forEach(track => track.stop());
                
                testResults.camera = { status: 'success', result };
                updateTestCard('camera', 'success', result);
                
            } catch (error) {
                const result = `âŒ æ‘„åƒå¤´æƒé™è·å–å¤±è´¥: ${error.message}`;
                testResults.camera = { status: 'error', result };
                updateTestCard('camera', 'error', result);
            }
            
            completedTests++;
            updateProgress();
            updateSummary();
        }
        
        async function testNotification() {
            updateTestCard('notification', 'pending', 'æ­£åœ¨æµ‹è¯•é€šçŸ¥æƒé™...');
            
            try {
                if (!('Notification' in window)) {
                    throw new Error('æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥API');
                }
                
                let permission = Notification.permission;
                
                if (permission === 'default') {
                    permission = await Notification.requestPermission();
                }
                
                let result;
                if (permission === 'granted') {
                    // å°è¯•å‘é€æµ‹è¯•é€šçŸ¥
                    const notification = new Notification('æƒé™æµ‹è¯•', {
                        body: 'é€šçŸ¥æƒé™æµ‹è¯•æˆåŠŸï¼',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ””</text></svg>'
                    });
                    
                    setTimeout(() => notification.close(), 3000);
                    
                    result = `âœ… é€šçŸ¥æƒé™è·å–æˆåŠŸï¼
æƒé™çŠ¶æ€: ${permission}
å¯ä»¥å‘é€é€šçŸ¥: æ˜¯`;
                    
                    testResults.notification = { status: 'success', result };
                    updateTestCard('notification', 'success', result);
                } else {
                    result = `âš ï¸ é€šçŸ¥æƒé™è¢«æ‹’ç»
æƒé™çŠ¶æ€: ${permission}
å¯ä»¥å‘é€é€šçŸ¥: å¦`;
                    
                    testResults.notification = { status: 'warning', result };
                    updateTestCard('notification', 'warning', result);
                }
                
            } catch (error) {
                const result = `âŒ é€šçŸ¥æƒé™æµ‹è¯•å¤±è´¥: ${error.message}`;
                testResults.notification = { status: 'error', result };
                updateTestCard('notification', 'error', result);
            }
            
            completedTests++;
            updateProgress();
            updateSummary();
        }
        
        async function testClipboard() {
            updateTestCard('clipboard', 'pending', 'æ­£åœ¨æµ‹è¯•å‰ªè´´æ¿æƒé™...');
            
            try {
                if (!navigator.clipboard) {
                    throw new Error('æµè§ˆå™¨ä¸æ”¯æŒå‰ªè´´æ¿API');
                }
                
                // å°è¯•è¯»å–å‰ªè´´æ¿
                const clipboardItems = await navigator.clipboard.read();
                
                let result = `âœ… å‰ªè´´æ¿æƒé™è·å–æˆåŠŸï¼
å‰ªè´´æ¿é¡¹ç›®æ•°: ${clipboardItems.length}`;
                
                if (clipboardItems.length > 0) {
                    for (const item of clipboardItems) {
                        result += `\næ”¯æŒçš„ç±»å‹: ${item.types.join(', ')}`;
                    }
                } else {
                    result += '\nå‰ªè´´æ¿ä¸ºç©º';
                }
                
                testResults.clipboard = { status: 'success', result };
                updateTestCard('clipboard', 'success', result);
                
            } catch (error) {
                const result = `âŒ å‰ªè´´æ¿æƒé™è·å–å¤±è´¥: ${error.message}`;
                testResults.clipboard = { status: 'error', result };
                updateTestCard('clipboard', 'error', result);
            }
            
            completedTests++;
            updateProgress();
            updateSummary();
        }
        
        async function testStorage() {
            updateTestCard('storage', 'pending', 'æ­£åœ¨æµ‹è¯•å­˜å‚¨æƒé™...');
            
            try {
                let result = 'âœ… å­˜å‚¨æƒé™æµ‹è¯•ç»“æœ:\n';
                
                // æµ‹è¯• localStorage
                try {
                    localStorage.setItem('test_key', 'test_value');
                    const value = localStorage.getItem('test_key');
                    localStorage.removeItem('test_key');
                    result += `localStorage: å¯ç”¨\n`;
                } catch (e) {
                    result += `localStorage: ä¸å¯ç”¨ (${e.message})\n`;
                }
                
                // æµ‹è¯• sessionStorage
                try {
                    sessionStorage.setItem('test_key', 'test_value');
                    const value = sessionStorage.getItem('test_key');
                    sessionStorage.removeItem('test_key');
                    result += `sessionStorage: å¯ç”¨\n`;
                } catch (e) {
                    result += `sessionStorage: ä¸å¯ç”¨ (${e.message})\n`;
                }
                
                // æµ‹è¯• IndexedDB
                try {
                    if ('indexedDB' in window) {
                        result += `IndexedDB: æ”¯æŒ\n`;
                    } else {
                        result += `IndexedDB: ä¸æ”¯æŒ\n`;
                    }
                } catch (e) {
                    result += `IndexedDB: é”™è¯¯ (${e.message})\n`;
                }
                
                // æµ‹è¯• Web Storage é…é¢
                try {
                    if ('storage' in navigator && 'estimate' in navigator.storage) {
                        const estimate = await navigator.storage.estimate();
                        result += `å­˜å‚¨é…é¢: ${Math.round(estimate.quota / 1024 / 1024)}MB\n`;
                        result += `å·²ä½¿ç”¨: ${Math.round(estimate.usage / 1024 / 1024)}MB`;
                    } else {
                        result += `å­˜å‚¨é…é¢: æ— æ³•è·å–`;
                    }
                } catch (e) {
                    result += `å­˜å‚¨é…é¢: é”™è¯¯ (${e.message})`;
                }
                
                testResults.storage = { status: 'success', result };
                updateTestCard('storage', 'success', result);
                
            } catch (error) {
                const result = `âŒ å­˜å‚¨æƒé™æµ‹è¯•å¤±è´¥: ${error.message}`;
                testResults.storage = { status: 'error', result };
                updateTestCard('storage', 'error', result);
            }
            
            completedTests++;
            updateProgress();
            updateSummary();
        }
        
        async function startAllTests() {
            if (isTestRunning) return;
            
            isTestRunning = true;
            completedTests = 0;
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('countdown').style.display = 'none';
            
            // å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰æµ‹è¯•
            const tests = [
                testGeolocation(),
                testMicrophone(),
                testCamera(),
                testNotification(),
                testClipboard(),
                testStorage()
            ];
            
            try {
                await Promise.allSettled(tests);
            } catch (error) {
                console.error('æµ‹è¯•æ‰§è¡Œé”™è¯¯:', error);
            }
            
            isTestRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
        
        function stopAllTests() {
            isTestRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
        
        function resetAllTests() {
            isTestRunning = false;
            completedTests = 0;
            
            testResults = {
                geolocation: { status: 'pending', result: '' },
                microphone: { status: 'pending', result: '' },
                camera: { status: 'pending', result: '' },
                notification: { status: 'pending', result: '' },
                clipboard: { status: 'pending', result: '' },
                storage: { status: 'pending', result: '' }
            };
            
            // é‡ç½®æ‰€æœ‰å¡ç‰‡
            const testNames = ['geolocation', 'microphone', 'camera', 'notification', 'clipboard', 'storage'];
            testNames.forEach(name => {
                updateTestCard(name, 'pending', `å‡†å¤‡æµ‹è¯•${name}æƒé™...`);
            });
            
            // é‡ç½®è¿›åº¦æ¡å’Œç»Ÿè®¡
            updateProgress();
            updateSummary();
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
    </script>
</body>
</html>
